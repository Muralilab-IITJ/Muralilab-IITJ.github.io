<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team | Murali Lab | IIT Jodhpur</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
    <div class="header-container">
        <div class="logo-section">
            <a href="index.html">
                <img src="images/iitj_logo_black.png" alt="University Logo" class="university-logo">
            </a>

            <div class="logo-text-group">
                <h1><a href="index.html" style="text-decoration: none; color: inherit;">Murali Lab</a></h1>
                <p>IIT Jodhpur</p>
            </div>
        </div>
        
        <div class="menu-toggle" id="mobile-menu">
            <i class="fas fa-bars"></i>
        </div>

        <nav>
            <ul class="nav-links">
                <li><a href="research.html">Research</a></li>
                <li><a href="publications.html">Publications</a></li>
                <li><a href="team.html">Team</a></li>
                <li><a href="teaching.html">Teaching</a></li>
                <li><a href="opportunity.html">Opportunities</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </div>
</header>
    
    <main>
        <h2 class="page-title">Our Team</h2>
        
        <div class="team-categories">
            <button class="category-btn active" data-category="all">All Members</button>
            <button class="category-btn" data-category="faculty">Faculty</button>
            <button class="category-btn" data-category="phd">PhD Students</button>
            <button class="category-btn" data-category="masters">Master's Students</button>
            <button class="category-btn" data-category="undergraduate">Undergraduate Students</button>
            <button class="category-btn" data-category="staff">Research Staff</button>
            
            <button class="category-btn" data-category="executive">Executive M. Tech</button>
            
            <button class="category-btn" data-category="alumni">Alumni</button>
        </div>

        <div id="team-container" class="team-container">
            <div id="team-loading" class="loading">Loading team members...</div>
        </div>
        
        <div id="alumni-list-section" class="alumni-list-section" style="display: none;">
            <h3>Btech Project/Design Credits/Internship Alumni</h3>
            <ul id="alumni-simple-list" class="alumni-simple-list">
            </ul>
        </div>

        <div id="executive-list-section" class="alumni-list-section" style="display: none;">
            <h3>Executive M. Tech Students</h3>
            <ul id="executive-simple-list" class="alumni-simple-list">
            </ul>
        </div>
        
        <div id="team-error" class="error-message" style="display: none;"></div>

        <div class="join-cta">
            <h3>Interested in joining our team?</h3>
            <p>We're always looking for passionate researchers at all levels. Check out our <a href="opportunity.html">opportunities</a> page.</p>
        </div>
    </main>
    
    <footer>
        <div class="footer-container">
            <div class="copyright">
                <p>© 2025 Murali Lab | IIT Jodhpur</p>
                <p class="developer-credit">Developed by: Ashish V., Dr. Vignesh & Murali Lab members</p>
            </div>
        </div>
    </footer>

   <script>
        // ==========================================
        // TEAM LOADING & DISPLAY LOGIC
        // ==========================================
        async function loadTeam() {
            const teamContainer = document.getElementById('team-container');
            const loadingElement = document.getElementById('team-loading');
            const errorElement = document.getElementById('team-error');

            try {
                const response = await fetch('./team.json');
                if (!response.ok) throw new Error('Failed to load team data');
                const data = await response.json();
                
                // 1. Display Card Profiles
                displayTeam(data.team);
                
                // 2. Display Alumni List
                if (data.alumni_list) {
                    displayAlumniList(data.alumni_list);
                }

                // 3. Display Executive List (NEW)
                if (data.executive_list) {
                    displayExecutiveList(data.executive_list);
                }
                
                // 4. Trigger Filter to hide lists initially
                const allBtn = document.querySelector('.category-btn[data-category="all"]');
                if (allBtn) {
                    setTimeout(() => allBtn.click(), 10);
                }

                loadingElement.style.display = 'none';
            } catch (error) {
                console.error(error);
                loadingElement.style.display = 'none';
                errorElement.style.display = 'block';
                errorElement.innerHTML = `<p>Unable to load team members. Ensure <strong>team.json</strong> is in the same folder.</p>`;
            }
        }

        // Display Regular Cards
        function displayTeam(members) {
            const teamContainer = document.getElementById('team-container');
            
            teamContainer.innerHTML = members.map(member => {
                const socialLinksHTML = generateSocialLinks(member.links);
                const emailLink = member.email 
                    ? `<a href="mailto:${convertEmailFormat(member.email)}" title="Email"><i class="fa-regular fa-envelope"></i></a>` 
                    : '';

                return `
                    <div class="team-member" data-category="${member.category}">
                        <div class="member-photo">
                            <img src="${member.photo}" alt="${member.name}" onerror="this.src='https://via.placeholder.com/200'">
                        </div>
                        <div class="member-info">
                            <h3 class="member-name">${member.name}</h3>
                            <div class="member-position">${member.position}</div>
                            <div class="member-bio">
                                <p>${member.bio}</p>
                            </div>
                            <div class="member-interests">
                                ${member.interests.map(interest => `<span class="interest-tag">${interest}</span>`).join('')}
                            </div>
                            <div class="member-social-row">
                                ${emailLink}
                                ${socialLinksHTML}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            initReadMore();
        }

        // Display Alumni List
        function displayAlumniList(list) {
            const listContainer = document.getElementById('alumni-simple-list');
            if (!list || list.length === 0) return;
            listContainer.innerHTML = list.map(person => `
                <li>
                    <strong>${person.name}</strong>
                    <span class="alumni-details">
                        (${person.period}, ${person.position} — Now: ${person.current})
                    </span>
                </li>
            `).join('');
        }

        // NEW: Display Executive List
        function displayExecutiveList(list) {
            const listContainer = document.getElementById('executive-simple-list');
            if (!list || list.length === 0) return;
            listContainer.innerHTML = list.map(person => `
                <li>
                    <strong>${person.name}</strong>
                    <span class="alumni-details">
                        (${person.details})
                    </span>
                </li>
            `).join('');
        }

        function generateSocialLinks(links) {
            if (!links || Object.keys(links).length === 0) return '';
            const iconMap = { 'linkedin': 'fab fa-linkedin', 'scholar': 'fas fa-graduation-cap', 'orcid': 'fab fa-orcid', 'github': 'fab fa-github', 'twitter': 'fab fa-twitter', 'website': 'fas fa-globe' };
            let linksHTML = '';
            Object.entries(links).forEach(([platform, url]) => {
                if (url && iconMap[platform]) linksHTML += `<a href="${url}" target="_blank" rel="noopener" title="${platform}"><i class="${iconMap[platform]}"></i></a>`;
            });
            return linksHTML;
        }

        function convertEmailFormat(email) {
            return email ? email.replace(/\[at\]/g, '@').replace(/\[dot\]/g, '.') : '';
        }

        // ==========================================
        // UPDATED FILTER LOGIC
        // ==========================================
        function setupCategoryFilter() {
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', () => {
                    // 1. Visual update for buttons
                    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // 2. Get Selection
                    const selectedCategory = button.dataset.category;
                    
                    // Elements to toggle
                    const alumniSection = document.getElementById('alumni-list-section');
                    const executiveSection = document.getElementById('executive-list-section');
                    const teamMembers = document.querySelectorAll('.team-member');

                    // 3. LOGIC SWITCH
                    
                    // CASE A: Executive Tab Clicked
                    if (selectedCategory === 'executive') {
                        alumniSection.style.display = 'none';
                        executiveSection.style.display = 'block';
                        // Hide all card members
                        teamMembers.forEach(m => m.style.display = 'none');
                    
                    // CASE B: Alumni Tab Clicked
                    } else if (selectedCategory === 'alumni') {
                        alumniSection.style.display = 'block';
                        executiveSection.style.display = 'none';
                        // Hide all card members
                        teamMembers.forEach(m => m.style.display = 'none');

                    // CASE C: Regular Categories (All, Faculty, PhD...)
                    } else {
                        alumniSection.style.display = 'none';
                        executiveSection.style.display = 'none';
                        
                        // Show/Hide cards based on category
                        teamMembers.forEach(member => {
                            const memberCategory = member.dataset.category;
                            // Note: We exclude alumni/executive from 'all' so they don't double dip
                            if (selectedCategory === 'all') {
                                member.style.display = (memberCategory !== 'alumni' && memberCategory !== 'executive') ? 'flex' : 'none';
                            } else {
                                member.style.display = (memberCategory === selectedCategory) ? 'flex' : 'none';
                            }
                        });
                    }
                });
            });
        }

        function initReadMore() {
            document.querySelectorAll('.member-bio').forEach(bio => {
                const bioText = bio.querySelector('p');
                if (bioText.textContent.length > 200) {
                    bioText.classList.add('collapsed');
                    bio.insertAdjacentHTML('beforeend', '<button class="read-more-btn">Read more</button>');
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupCategoryFilter(); 
            loadTeam();            
        });

        // Read More Click Handler
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('read-more-btn')) {
                const bioContainer = e.target.closest('.member-bio');
                const bioText = bioContainer.querySelector('p');
                bioText.classList.toggle('collapsed');
                e.target.textContent = bioText.classList.contains('collapsed') ? 'Read more' : 'Read less';
            }
        });

        // Mobile Menu
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('mobile-menu');
            const nav = document.querySelector('nav');
            if (menuToggle && nav) {
                menuToggle.addEventListener('click', () => {
                    nav.classList.toggle('active');
                    const icon = menuToggle.querySelector('i');
                    if (nav.classList.contains('active')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            }
        });
    </script>
</body>
</html>