<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team | Murali Lab | IIT Jodhpur</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-section">
                <h1><a href="index.html" style="text-decoration: none; color: inherit;">Murali Lab</a></h1>
                <p>IIT Jodhpur</p>
            </div>
            <nav>
                <ul>
                    <li><a href="research.html">Research</a></li>
                    <li><a href="publications.html">Publications</a></li>
                    <li><a href="team.html" class="active">Team</a></li>
                    <li><a href="teaching.html">Teaching</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <main>
        <h2 class="page-title">Our Team</h2>
        
        <div class="team-categories">
            <button class="category-btn active" data-category="current">Current Members</button>
            <button class="category-btn" data-category="faculty">Faculty</button>
            <button class="category-btn" data-category="phd">PhD Students</button>
            <button class="category-btn" data-category="masters">Master's Students</button>
            <button class="category-btn" data-category="undergraduate">Undergraduate Students</button>
            <button class="category-btn" data-category="staff">Research Staff</button>
            <button class="category-btn" data-category="alumni">Alumni</button>
        </div>

        <div id="team-container" class="team-container">
            <div id="team-loading" class="loading">Loading team members...</div>
        </div>
        
        <div id="team-error" class="error-message" style="display: none;"></div>

        <div class="join-cta">
            <h3>Interested in joining our team?</h3>
            <p>We're always looking for passionate researchers at all levels. Check out our <a href="join.html">Join</a> page for current opportunities.</p>
        </div>
    </main>
    
    <footer>
        <div class="footer-container">
            <div class="copyright">
                <p>Â© 2025 Murali Lab | IIT Jodhpur</p>
            </div>
          <!--  <div class="social-links">
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-linkedin"></i></a>
                <a href="#"><i class="fab fa-github"></i></a>
            </div>-->
        </div>
    </footer>

    <script>
        async function loadTeam() {
            const teamContainer = document.getElementById('team-container');
            const loadingElement = document.getElementById('team-loading');
            const errorElement = document.getElementById('team-error');

            try {
                const response = await fetch('./team.json');
                if (!response.ok) throw new Error('Failed to load team data');
                const data = await response.json();
                displayTeam(data.team);
                loadingElement.style.display = 'none';
                
                // Initialize the filter to "Current Members" immediately after loading
                applyFilter('current');
            } catch (error) {
                console.error(error);
                loadingElement.style.display = 'none';
                errorElement.style.display = 'block';
                errorElement.innerHTML = `<p>Unable to load team members. Ensure <strong>team.json</strong> is in the same folder.</p>`;
            }
        }

        function displayTeam(members) {
            const teamContainer = document.getElementById('team-container');
            
            teamContainer.innerHTML = members.map(member => {
                const socialLinksHTML = generateSocialLinks(member.links);
                
                return `
                    <div class="team-member" data-category="${member.category}">
                        <div class="member-photo">
                            <img src="${member.photo}" alt="${member.name}" onerror="this.src='https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">
                        </div>
                        <div class="member-info">
                            <h3 class="member-name">${member.name}</h3>
                            <div class="member-position">${member.position}</div>
                            <div class="member-bio">
                                <p>${member.bio}</p>
                            </div>
                            <div class="member-interests">
                                ${member.interests.map(interest => `<span class="interest-tag">${interest}</span>`).join('')}
                            </div>
                            <div class="member-meta">
                                <a href="mailto:${convertEmailFormat(member.email)}" class="member-email">
                                    <i class="fas fa-envelope"></i> Email
                                </a>
                            </div>
                            ${socialLinksHTML}
                        </div>
                    </div>
                `;
            }).join('');

            // Read more logic
            document.querySelectorAll('.member-bio').forEach(bio => {
                const bioText = bio.querySelector('p');
                if (bioText.textContent.length > 250) {
                    bioText.classList.add('collapsed');
                    bio.insertAdjacentHTML('beforeend', '<button class="read-more-btn">Read more</button>');
                }
            });
        }

        function generateSocialLinks(links) {
            if (!links || Object.keys(links).length === 0) return '';
            const iconMap = {
                'linkedin': 'fab fa-linkedin',
                'scholar': 'fas fa-graduation-cap',
                'orcid': 'fab fa-orcid',
                'github': 'fab fa-github',
                'twitter': 'fab fa-twitter',
                'website': 'fas fa-globe'
            };
            let linksHTML = '';
            Object.entries(links).forEach(([platform, url]) => {
                if (url && iconMap[platform]) {
                    linksHTML += `<a href="${url}" class="social-link" target="_blank" rel="noopener"><i class="${iconMap[platform]}"></i></a>`;
                }
            });
            return linksHTML ? `<div class="member-social-links">${linksHTML}</div>` : '';
        }

        function convertEmailFormat(email) {
            return email ? email.replace(/\[at\]/g, '@').replace(/\[dot\]/g, '.') : '';
        }

        function applyFilter(category) {
            document.querySelectorAll('.team-member').forEach(member => {
                const memberCategory = member.dataset.category;
                
                if (category === 'current') {
                    // Show everyone EXCEPT alumni
                    member.style.display = (memberCategory !== 'alumni') ? 'flex' : 'none';
                } else {
                    // Show only exact match
                    member.style.display = (memberCategory === category) ? 'flex' : 'none';
                }
            });
        }

        function setupCategoryFilter() {
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    applyFilter(button.dataset.category);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadTeam();
            setupCategoryFilter();
        });

        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('read-more-btn')) {
                const bioContainer = e.target.closest('.member-bio');
                const bioText = bioContainer.querySelector('p');
                bioText.classList.toggle('collapsed');
                e.target.textContent = bioText.classList.contains('collapsed') ? 'Read more' : 'Read less';
            }
        });
    </script>
</body>
</html>