<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team | Murali Lab | IIT Jodhpur</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-section">
                <h1><a href="index.html" style="text-decoration: none; color: inherit;">Murali Lab</a></h1>
                <p>IIT Jodhpur</p>
            </div>
            <nav>
                <ul>
                    <li><a href="research.html">Research</a></li>
                    <li><a href="publications.html">Publications</a></li>
                    <li><a href="join.html">Join</a></li>
                    <li><a href="team.html" class="active">Team</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <main>
        <h2 class="page-title">Our Team</h2>
        
        <!-- Team Categories -->
        <div class="team-categories">
            <button class="category-btn active" data-category="all">All Members</button>
            <button class="category-btn" data-category="faculty">Faculty</button>
            <button class="category-btn" data-category="phd">PhD Students</button>
            <button class="category-btn" data-category="masters">Master's Students</button>
            <button class="category-btn" data-category="undergraduate">Undergraduate Students</button>
            <button class="category-btn" data-category="staff">Research Staff</button>
            <button class="category-btn" data-category="alumni">Alumni</button>
        </div>

        <!-- Team Members Grid -->
        <div id="team-container" class="team-container">
            <!-- Team members will be loaded here -->
            <div id="team-loading" class="loading">Loading team members...</div>
        </div>
        
        <div id="team-error" class="error-message" style="display: none;">
            Unable to load team information. Please check back later.
        </div>

        <!-- Join the Team CTA -->
        <div class="join-cta">
            <h3>Interested in joining our team?</h3>
            <p>We're always looking for passionate researchers at all levels. Check out our <a href="join.html">Join</a> page for current opportunities.</p>
        </div>
    </main>
    
    <footer>
        <div class="footer-container">
            <div class="copyright">
                <p>Â© 2025 Murali Lab | IIT Jodhpur</p>
            </div>
            <div class="social-links">
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-linkedin"></i></a>
                <a href="#"><i class="fab fa-github"></i></a>
            </div>
        </div>
    </footer>

    <script>
        // Load team data from JSON file
        async function loadTeam() {
            const teamContainer = document.getElementById('team-container');
            const loadingElement = document.getElementById('team-loading');
            const errorElement = document.getElementById('team-error');

            try {
                console.log('Attempting to load team.json...');
                // Fetch team data from JSON file
                const response = await fetch('./team.json');
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`Failed to load team: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Data loaded:', data);
                
                if (!data.team || data.team.length === 0) {
                    teamContainer.innerHTML = '<div class="no-members">No team members to display.</div>';
                    loadingElement.style.display = 'none';
                    return;
                }
                
                // Display the team
                displayTeam(data.team);
                loadingElement.style.display = 'none';
                
            } catch (error) {
                console.error('Error loading team:', error);
                console.error('Full error:', error.stack);
                
                // Show more detailed error
                errorElement.innerHTML = `
                    <p>Unable to load team information. Please check:</p>
                    <ol>
                        <li>Is team.json in the same directory as team.html?</li>
                        <li>Does team.json have valid JSON format?</li>
                        <li>Check browser console (F12) for more details.</li>
                    </ol>
                    <p>Error details: ${error.message}</p>
                `;
                loadingElement.style.display = 'none';
                errorElement.style.display = 'block';
                
                // Fallback: show static data as backup
                const fallbackData = {
                    team: [{
                        id: 1,
                        name: "Ashish",
                        position: "Junior Research Fellow (JRF)",
                        category: "staff",
                        bio: "Ashish completed his M.Tech in Biological Engineering from IIT Gandhinagar. From early on, he was fascinated by how the brain achieves remarkable feats that we often take for granted. During the COVID-19 lockdown, he came across lectures by Prof. Nancy Kanwisher, which addressed some of his questions about the brain, and eventually led him to study human motor behaviour. His research interests lie in motor control and sensorimotor neural oscillations. He is currently exploring the role of central and autonomic interaction during executive control of actions.",
                        photo: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80",
                        email: "ashish@iitj.ac.in",
                        interests: ["Motor Control", "Sensorimotor Neural Oscillations", "Executive Control"],
                        joinDate: "2023",
                        links: {
                            linkedin: "https://linkedin.com/in/ashishv",
                            scholar: "https://scholar.google.com/citations?user=MNO345"
                        }
                    }]
                };
                
                console.log('Trying fallback data...');
                displayTeam(fallbackData.team);
                teamContainer.innerHTML += '<p style="color: #e74c3c; text-align: center; margin-top: 20px;"><i>Note: Using fallback data. Check console for JSON loading errors.</i></p>';
            }
        }

        // Function to display team members
        function displayTeam(members) {
            const teamContainer = document.getElementById('team-container');
            
            const teamHTML = members.map(member => {
                // Generate social links HTML if they exist
                const socialLinksHTML = generateSocialLinks(member.links);
                
                return `
                    <div class="team-member" data-category="${member.category}">
                        <div class="member-photo">
                            <img src="${member.photo}" alt="${member.name}" onerror="this.src='https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">
                        </div>
                        <div class="member-info">
                            <h3 class="member-name">${member.name}</h3>
                            <div class="member-position">${member.position}</div>
                            <div class="member-bio">
                                <p>${member.bio}</p>
                            </div>
                            <div class="member-interests">
                                ${member.interests.map(interest => `<span class="interest-tag">${interest}</span>`).join('')}
                            </div>
                            <div class="member-meta">
                                <!-- REMOVED: Joined date -->
                                <a href="mailto:${convertEmailFormat(member.email)}" class="member-email">
                                    <i class="fas fa-envelope"></i> Email
                                </a>
                            </div>
                            <!-- ADDED: Social Links Section -->
                            ${socialLinksHTML}
                        </div>
                    </div>
                `;
            }).join('');

            teamContainer.innerHTML = teamHTML;
            
            // Add click event to expand/collapse bio
            document.querySelectorAll('.member-bio').forEach(bio => {
                const bioText = bio.querySelector('p');
                if (bioText.textContent.length > 250) {
                    bioText.classList.add('collapsed');
                    bio.insertAdjacentHTML('beforeend', '<button class="read-more-btn">Read more</button>');
                }
            });
        }

        function generateSocialLinks(links) {
            if (!links || Object.keys(links).length === 0) {
                return ''; // Return empty string if no links
            }
            
            const iconMap = {
                'linkedin': ['fab fa-linkedin', 'LinkedIn'],
                'scholar': ['fas fa-graduation-cap', 'Google Scholar'],
                'orcid': ['fab fa-orcid', 'ORCID'],
                'github': ['fab fa-github', 'GitHub'],
                'twitter': ['fab fa-twitter', 'Twitter'],
                'website': ['fas fa-globe', 'Website']
            };
            
            let linksHTML = '';
            
            Object.entries(links).forEach(([platform, url]) => {
                if (url && iconMap[platform]) {
                    const [iconClass, platformName] = iconMap[platform];
                    linksHTML += `
                        <a href="${url}" class="social-link" target="_blank" rel="noopener" title="${platformName}">
                            <i class="${iconClass}"></i>
                        </a>
                    `;
                }
            });
            
            if (linksHTML) {
                return `<div class="member-social-links">${linksHTML}</div>`;
            }
            
            return '';
        }

        // Convert email format from [at] and [dot] to @ and .
        function convertEmailFormat(email) {
            if (!email) return '';
            return email.replace(/\[at\]/g, '@').replace(/\[dot\]/g, '.');
        }

        // Category filtering
        function setupCategoryFilter() {
            const categoryButtons = document.querySelectorAll('.category-btn');
            
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Update active button
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Filter team members
                    const category = button.dataset.category;
                    filterTeamMembers(category);
                });
            });
        }

        function filterTeamMembers(category) {
            const allMembers = document.querySelectorAll('.team-member');
            
            if (category === 'all') {
                allMembers.forEach(member => {
                    member.style.display = 'flex';
                });
            } else {
                allMembers.forEach(member => {
                    if (member.dataset.category === category) {
                        member.style.display = 'flex';
                    } else {
                        member.style.display = 'none';
                    }
                });
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadTeam();
            setupCategoryFilter();
            
            // Read more button functionality
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('read-more-btn')) {
                    const bio = e.target.closest('.member-bio');
                    const bioText = bio.querySelector('p');
                    bioText.classList.toggle('collapsed');
                    e.target.textContent = bioText.classList.contains('collapsed') ? 'Read more' : 'Read less';
                }
            });
        });
    </script>
</body>
</html>